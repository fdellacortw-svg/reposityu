<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Illusion Hub Deobfuscator</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&family=Roboto+Mono&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: #000;
      min-height: 100vh;
      font-family: 'Poppins', sans-serif;
      overflow-x: hidden;
    }

    /* Loading Screen */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    .loading-screen.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .progress-loader {
      width: 150px;
      background: rgba(236, 236, 238, 0.253);
      height: 10px;
      border-radius: 7px;
      overflow: hidden;
    }

    .progress {
      width: 1px;
      height: 10px;
      border-radius: 7px;
      background: rgb(255, 255, 255);
      transition: 0.5s;
      animation: loading_44 2s cubic-bezier(0.4, 1.01, 1, 1) forwards;
    }

    @keyframes loading_44 {
      0% { width: 0%; }
      100% { width: 100%; }
    }

    /* Login Form */
    .login-container {
      display: none;
      min-height: 100vh;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .login-container.visible {
      display: flex;
    }

    .form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 2em;
      background-color: #171717;
      border-radius: 25px;
      transition: .4s ease-in-out;
      width: 100%;
      max-width: 320px;
    }

    #heading {
      text-align: center;
      margin: 1em 0 1.5em;
      color: rgb(255, 255, 255);
      font-size: 1.1em;
    }

    .field {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5em;
      border-radius: 25px;
      padding: 0.6em;
      border: none;
      outline: none;
      color: white;
      background-color: #171717;
      box-shadow: inset 2px 5px 10px rgb(5, 5, 5);
    }

    .input-icon {
      height: 1.3em;
      width: 1.3em;
      fill: white;
      flex-shrink: 0;
    }

    .input-field {
      background: none;
      border: none;
      outline: none;
      width: 100%;
      color: #d3d3d3;
      font-family: 'Poppins', sans-serif;
      font-size: 16px;
    }

    .form .btn {
      display: flex;
      justify-content: center;
      flex-direction: row;
      margin-top: 2em;
      margin-bottom: 1em;
    }

    .button1 {
      padding: 0.5em 1.5em;
      border-radius: 5px;
      border: none;
      outline: none;
      transition: .4s ease-in-out;
      background-color: #252525;
      color: white;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
      font-size: 1em;
    }

    .button1:hover {
      background-color: #64ffda;
      color: black;
    }

    .login-error {
      color: #ff6b6b;
      text-align: center;
      font-size: 0.85em;
      margin-top: 10px;
      display: none;
    }

    .login-error.show {
      display: block;
    }

    /* Main App */
    .main-app {
      display: none;
      min-height: 100vh;
      padding: 15px;
    }

    .main-app.visible {
      display: block;
    }

    /* Navigation Switch */
    .nav-container {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 15px 0;
      gap: 0;
    }

    /* Settings Button in Home */
    .settings-btn-container {
      margin-top: 25px;
      margin-bottom: 20px;
      display: flex;
      justify-content: center;
    }

    .settings-open-btn {
      --main-focus: #333;
      --font-color: #dedede;
      --bg-color-sub: #1a1a1a;
      --bg-color: #2a2a2a;
      --main-color: #dedede;
      position: relative;
      width: 160px;
      height: 42px;
      cursor: pointer;
      display: flex;
      align-items: center;
      border: 2px solid var(--main-color);
      box-shadow: 4px 4px var(--main-color);
      background-color: var(--bg-color);
      border-radius: 10px;
      overflow: hidden;
      text-decoration: none;
    }

    .settings-open-btn, .settings-open-btn .button__icon, .settings-open-btn .button__text {
      transition: all 0.3s;
    }

    .settings-open-btn .button__text {
      transform: translateX(30px);
      color: var(--font-color);
      font-weight: 600;
      font-size: 13px;
    }

    .settings-open-btn .button__icon {
      position: absolute;
      transform: translateX(120px);
      height: 100%;
      width: 38px;
      background-color: var(--bg-color-sub);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .settings-open-btn .svg {
      width: 22px;
      fill: var(--main-color);
      transition: transform 0.4s ease;
    }

    .settings-open-btn:hover {
      background: var(--bg-color);
    }

    .settings-open-btn:hover .button__text {
      color: transparent;
    }

    .settings-open-btn:hover .button__icon {
      width: 158px;
      transform: translateX(0);
    }

    .settings-open-btn:hover .svg {
      transform: rotate(90deg);
    }

    .settings-open-btn:active {
      transform: translate(3px, 3px);
      box-shadow: 0px 0px var(--main-color);
    }

    .flip-switch-container {
      --card-width: 90px;
      --card-height: 100px;
      --switch-bg: rgba(255, 255, 255, 0.1);
      --switch-border-color: rgba(255, 255, 255, 0.2);
      --text-color: #ffffff;
      --inactive-text-color: rgba(255, 255, 255, 0.6);
      --icon-shadow-color: rgba(0, 0, 0, 0.3);
      --card-bg: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1));
      --highlight-color: #64ffda;
      display: grid;
      place-content: center;
      font-family: "Poppins", sans-serif;
    }

    @media (min-width: 768px) {
      .flip-switch-container {
        --card-width: 110px;
        --card-height: 120px;
      }
    }

    .flip-switch {
      display: flex;
      position: relative;
      width: calc(var(--card-width) * 2);
      height: var(--card-height);
      background: var(--switch-bg);
      border-radius: 20px;
      border: 1px solid var(--switch-border-color);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37), inset 0 4px 8px rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(12px);
      perspective: 1000px;
    }

    .flip-switch input[type="radio"] { display: none; }

    .flip-switch .switch-button {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      z-index: 2;
      color: var(--inactive-text-color);
      transition: all 0.3s ease;
      position: relative;
    }

    .flip-switch .switch-button:hover { color: var(--text-color); }
    .flip-switch .switch-button:hover svg {
      transform: translateY(-3px);
      filter: drop-shadow(0 4px 6px var(--icon-shadow-color)) brightness(1.2);
    }

    .flip-switch .switch-button svg {
      transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
      filter: drop-shadow(0 2px 3px var(--icon-shadow-color));
      width: 22px;
      height: 22px;
    }

    .flip-switch .switch-button span { font-size: 12px; font-weight: 500; letter-spacing: 0.5px; }

    @media (min-width: 768px) {
      .flip-switch .switch-button svg {
        width: 24px;
        height: 24px;
      }
      .flip-switch .switch-button span { font-size: 14px; }
    }

    .flip-switch #switch-opt-1:checked ~ [for="switch-opt-1"],
    .flip-switch #switch-opt-2:checked ~ [for="switch-opt-2"] {
      color: var(--text-color);
      text-shadow: 0 0 8px rgba(100, 255, 218, 0.5);
    }

    .flip-switch .switch-card {
      position: absolute;
      top: 0;
      left: 0;
      width: var(--card-width);
      height: var(--card-height);
      z-index: 1;
      transform-style: preserve-3d;
    }

    .flip-switch .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 20px;
      background: var(--card-bg);
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2), inset 0 2px 4px rgba(255, 255, 255, 0.1);
      backface-visibility: hidden;
    }

    .flip-switch .card-back { transform: rotateY(180deg); }

    .flip-switch #switch-opt-2:checked ~ .switch-card {
      animation: flipRight 0.6s cubic-bezier(0.76, 0, 0.24, 1) forwards;
    }

    .flip-switch #switch-opt-1:checked ~ .switch-card {
      animation: flipLeft 0.6s cubic-bezier(0.76, 0, 0.24, 1) forwards;
    }

    @keyframes flipRight {
      0% { transform: translateX(0%) rotateY(0deg); }
      50% { transform: translateX(50%) rotateY(90deg) scale(1.05); }
      100% { transform: translateX(100%) rotateY(180deg) scale(1); }
    }

    @keyframes flipLeft {
      0% { transform: translateX(100%) rotateY(180deg); }
      50% { transform: translateX(50%) rotateY(90deg) scale(1.05); }
      100% { transform: translateX(0%) rotateY(0deg) scale(1); }
    }

    .flip-switch #switch-opt-1:checked ~ [for="switch-opt-1"]::after,
    .flip-switch #switch-opt-2:checked ~ [for="switch-opt-2"]::after {
      content: "";
      position: absolute;
      bottom: -5px;
      width: 30px;
      height: 3px;
      background: var(--highlight-color);
      border-radius: 2px;
      animation: glow 1.5s infinite alternate;
    }

    @keyframes glow {
      from { box-shadow: 0 0 5px var(--highlight-color); }
      to { box-shadow: 0 0 15px var(--highlight-color), 0 0 25px var(--highlight-color); }
    }

    /* Settings Modal */
    .settings-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.85);
      z-index: 500;
      align-items: center;
      justify-content: center;
      padding: 15px;
    }

    .settings-modal.visible {
      display: flex;
    }

    .settings-panel {
      background: #1a1a1a;
      border-radius: 12px;
      padding: 15px 20px;
      max-width: 300px;
      width: 100%;
      border: 2px solid #dedede;
      box-shadow: 4px 4px #dedede;
      max-height: 90vh;
      overflow-y: auto;
    }

    .settings-title {
      color: #fff;
      font-size: 1em;
      margin-bottom: 12px;
      text-align: center;
      font-weight: 600;
    }

    .setting-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      gap: 10px;
    }

    .setting-item:last-child {
      border-bottom: none;
    }

    .setting-label {
      color: #fff;
      font-size: 0.8em;
    }

    .setting-desc {
      color: rgba(255,255,255,0.4);
      font-size: 0.6em;
      margin-top: 1px;
    }

    /* Toggle Switch */
    .switch {
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 44px;
      height: 22px;
      flex-shrink: 0;
    }

    .toggle {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #333;
      transition: 0.4s;
      border-radius: 22px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: 0.4s;
      border-radius: 50%;
    }

    .toggle:checked + .slider {
      background-color: #64ffda;
    }

    .toggle:checked + .slider:before {
      transform: translateX(22px);
    }

    .close-settings {
      margin-top: 12px;
      width: 100%;
      padding: 10px;
      background: #dedede;
      color: #000;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.8em;
      font-family: 'Poppins', sans-serif;
      transition: all 0.3s;
    }

    .close-settings:hover {
      background: #fff;
    }

    /* Fix with AI Button - Grigio uniforme come gli altri */
    .fix-ai-btn {
      --main-focus: #2d8cf0;
      --font-color: #dedede;
      --bg-color-sub: #222;
      --bg-color: #323232;
      --main-color: #dedede;
      position: relative;
      width: auto;
      min-width: 120px;
      height: 36px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
      padding: 0 12px;
      border: 2px solid var(--main-color);
      box-shadow: 3px 3px var(--main-color);
      background-color: var(--bg-color);
      border-radius: 8px;
      transition: all 0.3s;
      flex-shrink: 0;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      font-size: 12px;
      color: var(--font-color);
    }

    .fix-ai-btn svg {
      width: 16px;
      height: 16px;
      fill: var(--main-color);
    }

    .fix-ai-btn:hover {
      background: var(--bg-color-sub);
    }

    .fix-ai-btn:active {
      transform: translate(3px, 3px);
      box-shadow: 0px 0px var(--main-color);
    }

    @media (max-width: 600px) {
      .fix-ai-btn {
        min-width: 100px;
        font-size: 11px;
      }
      .fix-ai-btn svg {
        width: 14px;
        height: 14px;
      }
    }

    /* Mode Switch for Premium */
    .mode-switch-container {
      display: none;
      margin-top: 20px;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .mode-switch-container.visible {
      display: flex;
    }

    .mode-labels {
      display: flex;
      align-items: center;
      gap: 12px;
      color: #888;
      font-size: 0.85em;
    }

    .mode-labels span {
      transition: all 0.3s;
    }

    .mode-labels span.active {
      color: #fff;
      font-weight: 600;
    }

    .mode-switch {
      --input-focus: #666;
      --font-color: #323232;
      --font-color-sub: #666;
      --bg-color: #fff;
      --bg-color-alt: #666;
      --main-color: #888;
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 30px;
      width: 50px;
      height: 20px;
    }

    .mode-switch .toggle {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .mode-switch .slider {
      box-sizing: border-box;
      border-radius: 5px;
      border: 2px solid var(--main-color);
      box-shadow: 4px 4px var(--main-color);
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #333;
      transition: 0.3s;
    }

    .mode-switch .slider:before {
      box-sizing: border-box;
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      border: 2px solid var(--main-color);
      border-radius: 5px;
      left: -2px;
      bottom: 2px;
      background-color: var(--bg-color);
      box-shadow: 0 3px 0 var(--main-color);
      transition: 0.3s;
    }

    .mode-switch .toggle:checked + .slider {
      background-color: #555;
    }

    .mode-switch .toggle:checked + .slider:before {
      transform: translateX(30px);
    }

    /* Upload Box */
    .upload-box {
      width: 100%;
      max-width: 400px;
    }

    .upload-box-inner {
      cursor: pointer;
      background-color: #333;
      padding: 25px 30px;
      border-radius: 30px;
      border: 2px dashed #666;
      box-shadow: 0px 0px 200px -50px rgba(0, 0, 0, 0.5);
      transition: all 0.3s ease;
    }

    .upload-box-inner:hover {
      border-color: #64ffda;
      box-shadow: 0 0 30px rgba(100, 255, 218, 0.2);
    }

    .upload-box-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }

    .upload-box-content svg {
      height: 40px;
      fill: #666;
      margin-bottom: 12px;
      transition: all 0.3s;
    }

    .upload-box-inner:hover svg {
      fill: #64ffda;
    }

    .upload-box-content p {
      color: #eee;
      font-size: 0.85em;
      margin: 0;
      text-align: center;
    }

    .upload-box-content input[type="file"] {
      display: none;
    }

    .browse-button {
      background-color: #666;
      padding: 5px 15px;
      border-radius: 10px;
      color: #eee;
      transition: all 0.3s;
      margin-top: 10px;
      font-size: 0.85em;
    }

    .browse-button:hover {
      background-color: #888;
      color: #fff;
    }

    /* Link input styling */
    .link-input-field {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 15px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .link-input-field input {
      background: rgba(0, 0, 0, 0.3);
      border: none;
      border-radius: 25px;
      padding: 10px 15px;
      color: #fff;
      font-family: 'Roboto Mono', monospace;
      font-size: 0.75em;
      outline: none;
      width: 180px;
      text-align: center;
      box-shadow: inset 2px 5px 10px rgb(5, 5, 5);
    }

    .link-input-field input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    .link-submit-btn {
      background-color: #666;
      border: none;
      border-radius: 10px;
      padding: 8px 15px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      color: #eee;
      font-size: 0.8em;
      font-family: 'Poppins', sans-serif;
    }

    .link-submit-btn:hover {
      background-color: #64ffda;
      color: #000;
    }

    /* Drag mode content */
    .drag-mode-content {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* Paste mode content */
    .paste-mode-content {
      display: none;
      flex-direction: column;
      align-items: center;
    }

    .paste-mode-content.active {
      display: flex;
    }

    .drag-mode-content.hidden {
      display: none;
    }

    /* Content Sections */
    .content-section {
      display: none;
      padding: 20px 10px;
    }

    .content-section.active { display: flex; flex-direction: column; align-items: center; }

    /* Processing Animation */
    .processing-container {
      display: none;
      width: fit-content;
      gap: 10px;
      flex-direction: column;
      align-items: center;
    }

    .processing-container.active { display: flex; }

    .folder {
      width: min-content;
      margin: auto;
      animation: float 2s infinite linear;
    }

    .folder .top {
      background-color: #FF8F56;
      width: 60px;
      height: 12px;
      border-top-right-radius: 10px;
    }

    .folder .bottom {
      background-color: #FFCE63;
      width: 100px;
      height: 70px;
      box-shadow: 5px 5px 0 0 #283149;
      border-top-right-radius: 8px;
    }

    .processing-container .title {
      font-size: 1em;
      color: #fff;
      text-align: center;
      margin-top: 15px;
    }

    .processing-container .processing-subtitle {
      font-size: 0.75em;
      color: #64ffda;
      text-align: center;
      margin-top: 8px;
      opacity: 0.8;
    }

    @keyframes float {
      0% { transform: translatey(0px); }
      50% { transform: translatey(-25px); }
      100% { transform: translatey(0px); }
    }

    /* Profile Section */
    .profile-section {
      width: 100%;
      max-width: 800px;
    }

    .section-title {
      color: #fff;
      font-size: 1.2em;
      margin-bottom: 20px;
      text-align: center;
    }

    .files-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
      width: 100%;
    }

    .file-card {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      padding: 15px;
      backdrop-filter: blur(10px);
    }

    .file-header {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 15px;
    }

    @media (min-width: 600px) {
      .file-header {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
      }
    }

    .file-name {
      color: #64ffda;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9em;
      word-break: break-all;
    }

    .file-icon {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
    }

    .file-actions {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    /* Copy Button */
    .copy-btn {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background-color: #fff;
      color: #474747;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      flex-shrink: 0;
    }

    .copy-btn:hover {
      background-color: #64ffda;
    }

    .copy-btn svg {
      width: 18px;
      height: 18px;
    }

    /* Delete Button */
    .delete-btn {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background-color: rgb(20, 20, 20);
      border: none;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.164);
      cursor: pointer;
      transition-duration: .3s;
      overflow: hidden;
      position: relative;
      flex-shrink: 0;
    }

    .delete-btn .svgIcon {
      width: 12px;
      transition-duration: .3s;
    }

    .delete-btn .svgIcon path {
      fill: white;
    }

    .delete-btn:hover {
      width: 90px;
      border-radius: 50px;
      transition-duration: .3s;
      background-color: rgb(255, 69, 69);
      align-items: center;
    }

    .delete-btn:hover .svgIcon {
      width: 30px;
      transition-duration: .3s;
      transform: translateY(60%);
    }

    .delete-btn::before {
      position: absolute;
      top: -20px;
      content: "Delete";
      color: white;
      transition-duration: .3s;
      font-size: 2px;
    }

    .delete-btn:hover::before {
      font-size: 12px;
      opacity: 1;
      transform: translateY(30px);
      transition-duration: .3s;
    }

    /* Download Button */
    .download-btn {
      --main-focus: #2d8cf0;
      --font-color: #dedede;
      --bg-color-sub: #222;
      --bg-color: #323232;
      --main-color: #dedede;
      position: relative;
      width: 130px;
      height: 36px;
      cursor: pointer;
      display: flex;
      align-items: center;
      border: 2px solid var(--main-color);
      box-shadow: 3px 3px var(--main-color);
      background-color: var(--bg-color);
      border-radius: 8px;
      overflow: hidden;
      flex-shrink: 0;
    }

    .download-btn, .download-btn .button__icon, .download-btn .button__text {
      transition: all 0.3s;
    }

    .download-btn .button__text {
      transform: translateX(18px);
      color: var(--font-color);
      font-weight: 600;
      font-size: 12px;
    }

    .download-btn .button__icon {
      position: absolute;
      transform: translateX(92px);
      height: 100%;
      width: 36px;
      background-color: var(--bg-color-sub);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .download-btn .svg {
      width: 18px;
      fill: var(--main-color);
    }

    .download-btn:hover {
      background: var(--bg-color);
    }

    .download-btn:hover .button__text {
      color: transparent;
    }

    .download-btn:hover .button__icon {
      width: 128px;
      transform: translateX(0);
    }

    .download-btn:active {
      transform: translate(3px, 3px);
      box-shadow: 0px 0px var(--main-color);
    }

    .code-block {
      background: #1a1a1a;
      border-radius: 10px;
      padding: 12px;
      font-family: 'Roboto Mono', monospace;
      color: #fff;
      overflow-x: auto;
      white-space: pre-wrap;
      word-break: break-all;
      font-size: 0.65em;
      line-height: 1.4;
      max-height: 300px;
      overflow-y: auto;
      text-align: left;
    }

    .no-files {
      color: rgba(255, 255, 255, 0.5);
      text-align: center;
      padding: 30px 20px;
      font-size: 0.9em;
    }

    .file-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .file-date {
      color: rgba(255,255,255,0.4);
      font-size: 0.75em;
    }

    .file-time {
      color: #64ffda;
      font-size: 0.75em;
      background: rgba(100, 255, 218, 0.1);
      padding: 3px 8px;
      border-radius: 5px;
    }

    /* Premium Card */
    .premium-card {
      background: linear-gradient(135deg, #5865F2 0%, #7289da 100%);
      border-radius: 20px;
      padding: 25px 20px;
      margin-top: 30px;
      text-align: center;
      width: 100%;
      max-width: 400px;
    }

    .premium-card h3 {
      color: #fff;
      margin-bottom: 12px;
      font-size: 1.1em;
    }

    .premium-card p {
      color: rgba(255, 255, 255, 0.8);
      margin-bottom: 20px;
      font-size: 0.85em;
      line-height: 1.5;
    }

    /* Discord Join Button */
    .discord-join-btn {
      --main-focus: #5865F2;
      --font-color: #fff;
      --bg-color-sub: #4752C4;
      --bg-color: #5865F2;
      --main-color: #fff;
      position: relative;
      width: 160px;
      height: 42px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      border: 2px solid var(--main-color);
      box-shadow: 4px 4px var(--main-color);
      background-color: var(--bg-color);
      border-radius: 10px;
      overflow: hidden;
      text-decoration: none;
    }

    .discord-join-btn, .discord-join-btn .button__icon, .discord-join-btn .button__text {
      transition: all 0.3s;
    }

    .discord-join-btn .button__text {
      transform: translateX(25px);
      color: var(--font-color);
      font-weight: 600;
      font-size: 13px;
    }

    .discord-join-btn .button__icon {
      position: absolute;
      transform: translateX(120px);
      height: 100%;
      width: 38px;
      background-color: var(--bg-color-sub);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .discord-join-btn .svg {
      width: 22px;
      fill: var(--main-color);
    }

    .discord-join-btn:hover {
      background: var(--bg-color);
    }

    .discord-join-btn:hover .button__text {
      color: transparent;
    }

    .discord-join-btn:hover .button__icon {
      width: 158px;
      transform: translateX(0);
    }

    .discord-join-btn:active {
      transform: translate(3px, 3px);
      box-shadow: 0px 0px var(--main-color);
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: #64ffda;
      color: #000;
      padding: 12px 25px;
      border-radius: 10px;
      font-weight: 500;
      transition: transform 0.3s ease;
      z-index: 1000;
      font-size: 0.9em;
      text-align: center;
      max-width: 90%;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
    }

    /* AI Fixing Loader - Dentro il code block */
    .code-block-loader {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(26, 26, 26, 0.95);
      z-index: 10;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 15px;
      border-radius: 10px;
    }

    .code-block-loader.visible {
      display: flex;
    }

    .code-block-wrapper {
      position: relative;
    }

    .mini-loader {
      perspective: 400px;
      width: 60px;
      height: 60px;
    }

    .mini-cube {
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      animation: rotate 3s linear infinite;
    }

    .mini-face {
      position: absolute;
      width: 100%;
      height: 100%;
      opacity: 0.8;
      border: 0.5px solid #64ffda;
      background: linear-gradient(135deg, rgba(100, 255, 218, 0.1), rgba(100, 255, 218, 0.3));
    }

    .mini-face:nth-child(1) { transform: rotateX(90deg) translateZ(30px); }
    .mini-face:nth-child(2) { transform: rotateX(-90deg) translateZ(30px); }
    .mini-face:nth-child(3) { transform: translateZ(30px); }
    .mini-face:nth-child(4) { transform: rotateY(90deg) translateZ(30px); }
    .mini-face:nth-child(5) { transform: rotateY(-90deg) translateZ(30px); }
    .mini-face:nth-child(6) { transform: rotateY(180deg) translateZ(30px); }

    @keyframes rotate {
      0% { transform: rotateX(0deg) rotateY(0deg); }
      100% { transform: rotateX(360deg) rotateY(360deg); }
    }

    .loader-text {
      color: #64ffda;
      font-size: 0.85em;
      font-weight: 600;
      text-shadow: 0 0 10px rgba(100, 255, 218, 0.5);
    }

    /* Overlay loader (fallback) */
    .ai-loader-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 30px;
    }

    .ai-loader-overlay.visible {
      display: flex;
    }

    .loader {
      perspective: 600px;
      width: 100px;
      height: 100px;
    }

    .cube {
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      animation: rotate 4s linear infinite;
    }

    .face {
      position: absolute;
      width: 100%;
      height: 100%;
      opacity: 0.8;
      border: 0.5px solid #64ffda;
      background: linear-gradient(135deg, rgba(100, 255, 218, 0.1), rgba(100, 255, 218, 0.3));
    }

    .face:nth-child(1) { transform: rotateX(90deg) translateZ(50px); }
    .face:nth-child(2) { transform: rotateX(-90deg) translateZ(50px); }
    .face:nth-child(3) { transform: translateZ(50px); }
    .face:nth-child(4) { transform: rotateY(90deg) translateZ(50px); }
    .face:nth-child(5) { transform: rotateY(-90deg) translateZ(50px); }
    .face:nth-child(6) { transform: rotateY(180deg) translateZ(50px); }

    .ai-loader-text {
      color: #64ffda;
      font-size: 1.2em;
      font-weight: 600;
      text-shadow: 0 0 10px rgba(100, 255, 218, 0.5);
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div class="loading-screen" id="loadingScreen">
    <div class="progress-loader">
      <div class="progress"></div>
    </div>
  </div>

  <!-- Login Container -->
  <div class="login-container" id="loginContainer">
    <form class="form" id="loginForm">
      <p id="heading">Illusion Hub Deobfuscator</p>
      <div class="field">
        <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M13.106 7.222c0-2.967-2.249-5.032-5.482-5.032-3.35 0-5.646 2.318-5.646 5.702 0 3.493 2.235 5.708 5.762 5.708.862 0 1.689-.123 2.304-.335v-.862c-.43.199-1.354.328-2.29.328-2.926 0-4.813-1.88-4.813-4.798 0-2.844 1.921-4.881 4.594-4.881 2.735 0 4.608 1.688 4.608 4.156 0 1.682-.554 2.769-1.416 2.769-.492 0-.772-.28-.772-.76V5.206H8.923v.834h-.11c-.266-.595-.881-.964-1.6-.964-1.4 0-2.378 1.162-2.378 2.823 0 1.737.957 2.906 2.379 2.906.8 0 1.415-.39 1.709-1.087h.11c.081.67.703 1.148 1.503 1.148 1.572 0 2.57-1.415 2.57-3.643zm-7.177.704c0-1.197.54-1.907 1.456-1.907.93 0 1.524.738 1.524 1.907S8.308 9.84 7.371 9.84c-.895 0-1.442-.725-1.442-1.914z"></path>
        </svg>
        <input autocomplete="off" placeholder="Username" class="input-field" type="text" id="username">
      </div>
      <div class="field">
        <svg class="input-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"></path>
        </svg>
        <input placeholder="Password" class="input-field" type="password" id="password">
      </div>
      <div class="login-error" id="loginError">Invalid username or password</div>
      <div class="btn">
        <button type="submit" class="button1">Login</button>
      </div>
    </form>
  </div>

  <!-- Main App -->
  <div class="main-app" id="mainApp">
    <!-- Navigation -->
    <div class="nav-container">
      <div class="flip-switch-container">
        <div class="flip-switch">
          <input type="radio" id="switch-opt-1" name="flip-switch" checked />
          <input type="radio" id="switch-opt-2" name="flip-switch" />

          <label for="switch-opt-1" class="switch-button">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5z"></path>
            </svg>
            <span>Home</span>
          </label>

          <label for="switch-opt-2" class="switch-button">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
              <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"></path>
            </svg>
            <span>Profile</span>
          </label>

          <div class="switch-card">
            <div class="card-face card-front"></div>
            <div class="card-face card-back"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Home Section -->
    <div class="content-section active" id="homeSection">
      <!-- Upload Box -->
      <div class="upload-box" id="uploadBox">
        <div class="upload-box-inner" id="uploadBoxInner">
          <!-- Drag Mode (default) -->
          <div class="upload-box-content drag-mode-content" id="dragModeContent">
            <svg viewBox="0 0 640 512">
              <path d="M144 480C64.5 480 0 415.5 0 336c0-62.8 40.2-116.2 96.2-135.9c-.1-2.7-.2-5.4-.2-8.1c0-88.4 71.6-160 160-160c59.3 0 111 32.2 138.7 80.2C409.9 102 428.3 96 448 96c53 0 96 43 96 96c0 12.2-2.3 23.8-6.4 34.6C596 238.4 640 290.1 640 352c0 70.7-57.3 128-128 128H144zm79-217c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l39-39V392c0 13.3 10.7 24 24 24s24-10.7 24-24V257.9l39 39c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-80-80c-9.4-9.4-24.6-9.4-33.9 0l-80 80z"></path>
            </svg>
            <p>Drag and Drop</p>
            <p>or</p>
            <span class="browse-button">Browse file</span>
            <input id="file" type="file" />
          </div>
          
          <!-- Paste Mode (for premium) -->
          <div class="upload-box-content paste-mode-content" id="pasteModeContent">
            <svg viewBox="0 0 24 24">
              <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
            </svg>
            <p>Paste Script Link</p>
            <div class="link-input-field">
              <input type="text" id="linkInput" placeholder="https://..." />
              <button type="button" class="link-submit-btn" id="linkSubmitBtn">Deobfuscate</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Mode Switch (Premium only) -->
      <div class="mode-switch-container" id="modeSwitchContainer">
        <div class="mode-labels">
          <span id="dragLabel" class="active">Drag</span>
          <label class="mode-switch">
            <input class="toggle" type="checkbox" id="modeToggle">
            <span class="slider"></span>
          </label>
          <span id="pasteLabel">Paste</span>
        </div>
      </div>

      <!-- Settings Button -->
      <div class="settings-btn-container" id="settingsBtnHome">
        <button class="settings-open-btn" id="settingsOpenBtn">
          <span class="button__text">Settings</span>
          <span class="button__icon">
            <svg class="svg" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24">
              <path d="m370-80-16-128q-13-5-24.5-12T307-235l-119 50L78-375l103-78q-1-7-1-13.5v-27q0-6.5 1-13.5L78-585l110-190 119 50q11-8 23-15t24-12l16-128h220l16 128q13 5 24.5 12t22.5 15l119-50 110 190-103 78q1 7 1 13.5v27q0 6.5-2 13.5l103 78-110 190-118-50q-11 8-23 15t-24 12L590-80H370Zm70-80h79l14-106q31-8 57.5-23.5T639-327l99 41 39-68-86-65q5-14 7-29.5t2-31.5q0-16-2-31.5t-7-29.5l86-65-39-68-99 42q-22-23-48.5-38.5T533-694l-13-106h-79l-14 106q-31 8-57.5 23.5T321-633l-99-41-39 68 86 64q-5 15-7 30t-2 32q0 16 2 31t7 30l-86 65 39 68 99-42q22 23 48.5 38.5T427-266l13 106Zm42-180q58 0 99-41t41-99q0-58-41-99t-99-41q-59 0-99.5 41T342-480q0 58 40.5 99t99.5 41Zm-2-140Z"></path>
            </svg>
          </span>
        </button>
      </div>

      <!-- Processing Animation -->
      <div class="processing-container" id="processingContainer">
        <div class="folder">
          <div class="top"></div>
          <div class="bottom"></div>
        </div>
        <div class="title">Deobfuscation in progress...</div>
        <div class="processing-subtitle">made by illusion dev</div>
      </div>
    </div>

    <!-- Profile Section -->
    <div class="content-section" id="profileSection">
      <div class="profile-section">
        <h2 class="section-title">Deobfuscated Files</h2>
        <div class="files-list" id="filesList"></div>

        <!-- Premium Card -->
        <div class="premium-card">
          <h3>Read Links Directly?</h3>
          <p>Upgrade to Premium to deobfuscate links directly without uploading files!</p>
          <a href="https://discord.gg/BA78HDbU" target="_blank" class="discord-join-btn">
            <span class="button__text">Join Discord</span>
            <span class="button__icon">
              <svg class="svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/>
              </svg>
            </span>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="settings-modal" id="settingsModal">
    <div class="settings-panel">
      <h2 class="settings-title">Deobfuscator Settings</h2>
      
      <div class="setting-item">
        <div>
          <div class="setting-label">Lua Deobfuscator</div>
          <div class="setting-desc">Standard Lua bytecode deobfuscation</div>
        </div>
        <label class="switch">
          <input class="toggle" type="checkbox" id="settingLua" checked />
          <span class="slider"></span>
        </label>
      </div>

      <div class="setting-item">
        <div>
          <div class="setting-label">Luraph</div>
          <div class="setting-desc">Luraph obfuscator support</div>
        </div>
        <label class="switch">
          <input class="toggle" type="checkbox" id="settingLuraph" checked />
          <span class="slider"></span>
        </label>
      </div>

      <div class="setting-item">
        <div>
          <div class="setting-label">Moonsec</div>
          <div class="setting-desc">Moonsec v3 deobfuscation</div>
        </div>
        <label class="switch">
          <input class="toggle" type="checkbox" id="settingMoonsec" checked />
          <span class="slider"></span>
        </label>
      </div>

      <div class="setting-item">
        <div>
          <div class="setting-label">IronBrew</div>
          <div class="setting-desc">IronBrew 2 obfuscator support</div>
        </div>
        <label class="switch">
          <input class="toggle" type="checkbox" id="settingIronbrew" />
          <span class="slider"></span>
        </label>
      </div>

      <div class="setting-item">
        <div>
          <div class="setting-label">PSU</div>
          <div class="setting-desc">PSU obfuscator deobfuscation</div>
        </div>
        <label class="switch">
          <input class="toggle" type="checkbox" id="settingPSU" />
          <span class="slider"></span>
        </label>
      </div>

      <div class="setting-item">
        <div>
          <div class="setting-label">Beautify Output</div>
          <div class="setting-desc">Format and indent output code</div>
        </div>
        <label class="switch">
          <input class="toggle" type="checkbox" id="settingBeautify" checked />
          <span class="slider"></span>
        </label>
      </div>

      <div class="setting-item">
        <div>
          <div class="setting-label">Remake with AI</div>
          <div class="setting-desc">Use Gemini AI to enhance deobfuscation</div>
        </div>
        <label class="switch">
          <input class="toggle" type="checkbox" id="settingRemakeAI" />
          <span class="slider"></span>
        </label>
      </div>

      <button class="close-settings" id="closeSettingsBtn">Save Settings</button>
    </div>
  </div>

  <!-- AI Loader Overlay -->
  <div class="ai-loader-overlay" id="aiLoaderOverlay">
    <div class="loader">
      <div class="cube">
        <div class="face"></div>
        <div class="face"></div>
        <div class="face"></div>
        <div class="face"></div>
        <div class="face"></div>
        <div class="face"></div>
      </div>
    </div>
    <div class="ai-loader-text">AI is thinking...</div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast">Copied to clipboard!</div>

  <script>
    // ==================== CONFIGURATION ====================
    const USERS = {
      '9090': { password: '9090', premium: true }
    };

    const DEOBFUSCATION_TIME = 8; // seconds (processing time)

    // ==================== STATE ====================
    let currentUser = null;
    let deobfuscatedFiles = [];
    let fileCounter = 1;

    // ==================== DOM ELEMENTS ====================
    const elements = {
      loadingScreen: document.getElementById('loadingScreen'),
      loginContainer: document.getElementById('loginContainer'),
      loginForm: document.getElementById('loginForm'),
      loginError: document.getElementById('loginError'),
      username: document.getElementById('username'),
      password: document.getElementById('password'),
      mainApp: document.getElementById('mainApp'),
      homeSection: document.getElementById('homeSection'),
      profileSection: document.getElementById('profileSection'),
      switchOpt1: document.getElementById('switch-opt-1'),
      switchOpt2: document.getElementById('switch-opt-2'),
      uploadBox: document.getElementById('uploadBox'),
      fileInput: document.getElementById('file'),
      dragModeContent: document.getElementById('dragModeContent'),
      pasteModeContent: document.getElementById('pasteModeContent'),
      modeSwitchContainer: document.getElementById('modeSwitchContainer'),
      modeToggle: document.getElementById('modeToggle'),
      dragLabel: document.getElementById('dragLabel'),
      pasteLabel: document.getElementById('pasteLabel'),
      linkInput: document.getElementById('linkInput'),
      linkSubmitBtn: document.getElementById('linkSubmitBtn'),
      settingsBtnHome: document.getElementById('settingsBtnHome'),
      settingsOpenBtn: document.getElementById('settingsOpenBtn'),
      settingsModal: document.getElementById('settingsModal'),
      closeSettingsBtn: document.getElementById('closeSettingsBtn'),
      processingContainer: document.getElementById('processingContainer'),
      filesList: document.getElementById('filesList'),
      toast: document.getElementById('toast')
    };

    // ==================== STORAGE FUNCTIONS ====================
    function loadData() {
      try {
        const savedFiles = localStorage.getItem('illusionFiles');
        const savedCounter = localStorage.getItem('illusionCounter');
        const savedUser = localStorage.getItem('illusionUser');

        if (savedFiles) {
          deobfuscatedFiles = JSON.parse(savedFiles);
        }
        if (savedCounter) {
          fileCounter = parseInt(savedCounter, 10) || 1;
        }
        if (savedUser) {
          const userData = JSON.parse(savedUser);
          if (USERS[userData.name] && USERS[userData.name].password === userData.password) {
            currentUser = { name: userData.name, premium: USERS[userData.name].premium };
            return true;
          }
        }
      } catch (e) {
        console.error('Error loading data:', e);
      }
      return false;
    }

    function saveData() {
      try {
        localStorage.setItem('illusionFiles', JSON.stringify(deobfuscatedFiles));
        localStorage.setItem('illusionCounter', fileCounter.toString());
      } catch (e) {
        console.error('Error saving data:', e);
      }
    }

    function saveUser(username, password) {
      try {
        localStorage.setItem('illusionUser', JSON.stringify({ name: username, password: password }));
      } catch (e) {
        console.error('Error saving user:', e);
      }
    }

    // ==================== UI FUNCTIONS ====================
    function showToast(message) {
      elements.toast.textContent = message;
      elements.toast.classList.add('show');
      setTimeout(() => {
        elements.toast.classList.remove('show');
      }, 3000);
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function renderFiles() {
      const filesList = elements.filesList;
      filesList.innerHTML = '';

      if (deobfuscatedFiles.length === 0) {
        filesList.innerHTML = '<div class="no-files">No deobfuscated files yet. Upload a file from Home!</div>';
        return;
      }

      deobfuscatedFiles.forEach((file, index) => {
        const card = document.createElement('div');
        card.className = 'file-card';
        card.innerHTML = `
          <div class="file-header">
            <span class="file-name">
              <svg class="file-icon" viewBox="0 0 24 24" fill="#64ffda">
                <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
              </svg>
              ${escapeHtml(file.name)}
            </span>
            <div class="file-actions">
              <button class="copy-btn" data-index="${index}" title="Copy">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                </svg>
              </button>
              <button class="delete-btn" data-index="${index}" title="Delete">
                <svg viewBox="0 0 448 512" class="svgIcon"><path d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"></path></svg>
              </button>
              <button class="download-btn" data-index="${index}">
                <span class="button__text">Download</span>
                <span class="button__icon">
                  <svg class="svg" viewBox="0 0 35 35">
                    <path d="M17.5,22.131a1.249,1.249,0,0,1-1.25-1.25V2.187a1.25,1.25,0,0,1,2.5,0V20.881A1.25,1.25,0,0,1,17.5,22.131Z"></path>
                    <path d="M17.5,22.693a3.189,3.189,0,0,1-2.262-.936L8.487,15.006a1.249,1.249,0,0,1,1.767-1.767l6.751,6.751a.7.7,0,0,0,.99,0l6.751-6.751a1.25,1.25,0,0,1,1.768,1.767l-6.752,6.751A3.191,3.191,0,0,1,17.5,22.693Z"></path>
                    <path d="M31.436,34.063H3.564A3.318,3.318,0,0,1,.25,30.749V22.011a1.25,1.25,0,0,1,2.5,0v8.738a.815.815,0,0,0,.814.814H31.436a.815.815,0,0,0,.814-.814V22.011a1.25,1.25,0,1,1,2.5,0v8.738A3.318,3.318,0,0,1,31.436,34.063Z"></path>
                  </svg>
                </span>
              </button>
              <button class="fix-ai-btn" data-index="${index}">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <g fill="none">
                    <path d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"></path>
                    <path d="M9.107 5.448c.598-1.75 3.016-1.803 3.725-.159l.06.16l.807 2.36a4 4 0 0 0 2.276 2.411l.217.081l2.36.806c1.75.598 1.803 3.016.16 3.725l-.16.06l-2.36.807a4 4 0 0 0-2.412 2.276l-.081.216l-.806 2.361c-.598 1.75-3.016 1.803-3.724.16l-.062-.16l-.806-2.36a4 4 0 0 0-2.276-2.412l-.216-.081l-2.36-.806c-1.751-.598-1.804-3.016-.16-3.724l.16-.062l2.36-.806A4 4 0 0 0 8.22 8.025l.081-.216zM11 6.094l-.806 2.36a6 6 0 0 1-3.49 3.649l-.25.091l-2.36.806l2.36.806a6 6 0 0 1 3.649 3.49l.091.25l.806 2.36l.806-2.36a6 6 0 0 1 3.49-3.649l.25-.09l2.36-.807l-2.36-.806a6 6 0 0 1-3.649-3.49l-.09-.25zM19 2a1 1 0 0 1 .898.56l.048.117l.35 1.026l1.027.35a1 1 0 0 1 .118 1.845l-.118.048l-1.026.35l-.35 1.027a1 1 0 0 1-1.845.117l-.048-.117l-.35-1.026l-1.027-.35a1 1 0 0 1-.118-1.845l.118-.048l1.026-.35l.35-1.027A1 1 0 0 1 19 2" fill="currentColor"></path>
                  </g>
                </svg>
                Fix with AI
              </button>
            </div>
          </div>
          <div class="code-block-wrapper">
            <div class="code-block" id="code-block-${index}">${escapeHtml(file.code)}</div>
            <div class="code-block-loader" id="loader-${index}">
              <div class="mini-loader">
                <div class="mini-cube">
                  <div class="mini-face"></div>
                  <div class="mini-face"></div>
                  <div class="mini-face"></div>
                  <div class="mini-face"></div>
                  <div class="mini-face"></div>
                  <div class="mini-face"></div>
                </div>
              </div>
              <div class="loader-text">AI is thinking...</div>
            </div>
          </div>
          <div class="file-meta">
            <span class="file-date">Processed: ${file.date}</span>
            <span class="file-time"> ${file.processTime}s</span>
          </div>
        `;
        filesList.appendChild(card);
      });

      // Add event listeners
      document.querySelectorAll('.copy-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const idx = parseInt(this.getAttribute('data-index'), 10);
          copyFile(idx);
        });
      });

      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const idx = parseInt(this.getAttribute('data-index'), 10);
          deleteFile(idx);
        });
      });

      document.querySelectorAll('.download-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const idx = parseInt(this.getAttribute('data-index'), 10);
          downloadFile(idx);
        });
      });

      document.querySelectorAll('.fix-ai-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const idx = parseInt(this.getAttribute('data-index'), 10);
          fixWithAI(idx);
        });
      });
    }

    // Fix with AI function - Usa OpenRouter API con modello gratuito
    async function fixWithAI(index) {
      if (index < 0 || index >= deobfuscatedFiles.length) {
        showToast('Error: File not found');
        return;
      }

      // Mostra loader dentro il code block
      const codeBlockLoader = document.getElementById(`loader-${index}`);
      if (codeBlockLoader) {
        codeBlockLoader.classList.add('visible');
      }

      const file = deobfuscatedFiles[index];
      const originalCode = file.code;

      try {
        const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer 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',
            'HTTP-Referer': window.location.origin,
            'X-Title': 'Illusion Deobfuscator'
          },
          body: JSON.stringify({
            model: 'mistralai/mistral-7b-instruct:free',
            messages: [{
              role: 'user',
              content: `You are a Lua code deobfuscator and beautifier. Analyze this Lua code and improve it by:
1. Converting hex strings (\\x..) to readable text
2. Renaming obfuscated variables (like a, b, _0x123) to meaningful names
3. Removing dead/garbage code
4. Simplifying complex expressions
5. Formatting with proper indentation
6. Adding helpful comments where needed

Code to fix:
\`\`\`lua
${originalCode}
\`\`\`

Return ONLY the improved Lua code with the header "-- made by illusion dev" at the top. Do not include markdown code blocks in your response.`
            }]
          })
        });

        if (!response.ok) {
          const errorText = await response.text();
          console.error('OpenRouter API Error:', errorText);
          throw new Error(`API Error: ${response.status}`);
        }

        const data = await response.json();
        const fixedCode = data.choices[0].message.content.trim();

        // Nascondi loader
        if (codeBlockLoader) {
          codeBlockLoader.classList.remove('visible');
        }

        // Update the file
        deobfuscatedFiles[index].code = fixedCode;
        saveData();
        
        // Mostra toast successo
        showToast('Code fixed successfully!');
        
        // Salva flag per mostrare profile dopo reload
        localStorage.setItem('illusionShowProfile', 'true');
        
        // Ricarica la pagina dopo 1 secondo
        setTimeout(() => {
          location.reload();
        }, 1000);

      } catch (error) {
        console.error('AI fix error:', error);
        // Nascondi loader
        if (codeBlockLoader) {
          codeBlockLoader.classList.remove('visible');
        }
        showToast(`Could not fix with AI: ${error.message}`);
      }
    }

    // ==================== LUA BEAUTIFIER & DEOBFUSCATOR ====================
    function deobfuscateAndBeautify(code) {
      try {
        let result = code;
        
        // 1. Convert hex strings to readable text
        // Matches patterns like "\x48\x65\x6c\x6c\x6f" or '\x48\x65\x6c\x6c\x6f'
        result = result.replace(/\\x([0-9A-Fa-f]{2})/g, (match, hex) => {
          return String.fromCharCode(parseInt(hex, 16));
        });
        
        // 2. Convert unicode escapes
        result = result.replace(/\\u([0-9A-Fa-f]{4})/g, (match, hex) => {
          return String.fromCharCode(parseInt(hex, 16));
        });
        
        // 3. Convert octal escapes
        result = result.replace(/\\([0-7]{1,3})/g, (match, octal) => {
          const code = parseInt(octal, 8);
          if (code > 255) return match;
          return String.fromCharCode(code);
        });
        
        // 4. Remove excessive empty lines (more than 2 in a row)
        result = result.replace(/\n{3,}/g, '\n\n');
        
        // 5. Remove trailing whitespace from lines
        result = result.replace(/[ \t]+$/gm, '');
        
        // 6. Beautify/format the code with proper indentation
        result = beautifyLua(result);
        
        // 7. Add header
        const header = `-- made by illusion dev
-- Deobfuscated & Beautified
-- ================================

`;
        
        return header + result;
        
      } catch (error) {
        console.error('Deobfuscation error:', error);
        return `-- made by illusion dev
-- Beautified Code
-- ================================

${code}`;
      }
    }
    
    // Lua code beautifier
    function beautifyLua(code) {
      const lines = code.split('\n');
      let indentLevel = 0;
      const indentString = '    '; // 4 spaces
      const beautifiedLines = [];
      
      // Keywords that increase indent
      const increaseIndent = /^(function|if|for|while|repeat|do|else|elseif|local\s+function)\b/;
      // Keywords that decrease indent
      const decreaseIndent = /^(end|else|elseif|until)\b/;
      // Keywords that are standalone
      const standaloneDecrease = /^(end|until)\b/;
      
      for (let i = 0; i < lines.length; i++) {
        let line = lines[i].trim();
        
        // Skip empty lines but keep them
        if (line === '') {
          beautifiedLines.push('');
          continue;
        }
        
        // Check if line starts with decrease keyword
        if (decreaseIndent.test(line)) {
          indentLevel = Math.max(0, indentLevel - 1);
        }
        
        // Add indentation
        const indentedLine = indentString.repeat(indentLevel) + line;
        beautifiedLines.push(indentedLine);
        
        // Check if line ends with increase pattern or starts with increase keyword
        const hasDoEnd = /\bdo\s*$/.test(line) || /\bthen\s*$/.test(line);
        const hasFunctionStart = /\bfunction\s*\(/.test(line) && !/\bend\s*$/.test(line);
        const startsWithIncrease = increaseIndent.test(line);
        
        if (hasDoEnd || hasFunctionStart || (startsWithIncrease && !standaloneDecrease.test(line) && !/\bend\s*$/.test(line))) {
          indentLevel++;
        }
        
        // Handle one-liner functions/ifs that end on same line
        if (/\bend\s*$/.test(line) && (hasFunctionStart || /\bthen\b/.test(line))) {
          // It's a one-liner, don't increase indent
          indentLevel = Math.max(0, indentLevel - 1);
        }
      }
      
      return beautifiedLines.join('\n');
    }

    // ==================== FILE OPERATIONS ====================
    function copyFile(index) {
      if (index < 0 || index >= deobfuscatedFiles.length) {
        showToast('Error: File not found');
        return;
      }
      navigator.clipboard.writeText(deobfuscatedFiles[index].code).then(() => {
        showToast('Copied to clipboard!');
      }).catch(() => {
        showToast('Error copying to clipboard');
      });
    }

    function deleteFile(index) {
      if (index < 0 || index >= deobfuscatedFiles.length) {
        showToast('Error: File not found');
        return;
      }
      deobfuscatedFiles.splice(index, 1);
      saveData();
      renderFiles();
      showToast('File deleted!');
    }

    function downloadFile(index) {
      if (index < 0 || index >= deobfuscatedFiles.length) {
        showToast('Error: File not found');
        return;
      }
      const file = deobfuscatedFiles[index];
      const blob = new Blob([file.code], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = file.name + '.lua';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
      showToast('File downloaded!');
    }

    // Store pending file for processing
    let pendingFileContent = null;

    async function processFile(fileContent) {
      // Hide upload, show processing
      elements.uploadBox.style.display = 'none';
      elements.modeSwitchContainer.style.display = 'none';
      elements.settingsBtnHome.style.display = 'none';
      elements.processingContainer.classList.add('active');

      const startTime = Date.now();

      try {
        // Just add header without beautifying
        const header = `-- made by illusion dev\n\n`;
        const deobfuscatedCode = header + fileContent;
        
        // Wait for processing time
        await new Promise(resolve => setTimeout(resolve, DEOBFUSCATION_TIME * 1000));

        // Create new file
        const newFile = {
          name: 'Deobfuscated ' + fileCounter,
          code: deobfuscatedCode,
          date: new Date().toLocaleString(),
          processTime: DEOBFUSCATION_TIME
        };

        // Add to array
        deobfuscatedFiles.push(newFile);
        fileCounter++;

        // Save to localStorage
        saveData();
        
        // Save flag to show profile on reload
        localStorage.setItem('illusionShowProfile', 'true');

        // Reload page automatically
        location.reload();

      } catch (error) {
        console.error('Processing error:', error);
        
        // Create error file
        const newFile = {
          name: 'Deobfuscated ' + fileCounter,
          code: `-- made by illusion dev\n\n${fileContent}`,
          date: new Date().toLocaleString(),
          processTime: DEOBFUSCATION_TIME
        };

        deobfuscatedFiles.push(newFile);
        fileCounter++;
        saveData();
        localStorage.setItem('illusionShowProfile', 'true');
        location.reload();
      }
    }

    // ==================== MODE TOGGLE ====================
    function toggleMode() {
      if (elements.modeToggle.checked) {
        elements.dragModeContent.classList.add('hidden');
        elements.pasteModeContent.classList.add('active');
        elements.dragLabel.classList.remove('active');
        elements.pasteLabel.classList.add('active');
      } else {
        elements.dragModeContent.classList.remove('hidden');
        elements.pasteModeContent.classList.remove('active');
        elements.dragLabel.classList.add('active');
        elements.pasteLabel.classList.remove('active');
      }
    }

    // ==================== EVENT LISTENERS ====================
    // Login
    elements.loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const username = elements.username.value;
      const password = elements.password.value;

      if (USERS[username] && USERS[username].password === password) {
        currentUser = { name: username, premium: USERS[username].premium };
        saveUser(username, password);
        elements.loginContainer.classList.remove('visible');
        elements.mainApp.classList.add('visible');
        if (currentUser.premium) {
          elements.modeSwitchContainer.classList.add('visible');
        }
        elements.loginError.classList.remove('show');
        renderFiles();
      } else {
        elements.loginError.classList.add('show');
      }
    });

    // Navigation
    elements.switchOpt1.addEventListener('change', () => {
      elements.homeSection.classList.add('active');
      elements.profileSection.classList.remove('active');
    });

    elements.switchOpt2.addEventListener('change', () => {
      elements.profileSection.classList.add('active');
      elements.homeSection.classList.remove('active');
      renderFiles();
    });

    // File upload
    elements.dragModeContent.addEventListener('click', () => {
      elements.fileInput.click();
    });

    elements.fileInput.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        const file = e.target.files[0];
        const reader = new FileReader();
        
        reader.onload = function(event) {
          const content = event.target.result;
          processFile(content);
        };
        
        reader.onerror = function() {
          showToast('Error reading file');
        };
        
        reader.readAsText(file);
      }
    });

    // Link submit - fetch content from URL
    elements.linkSubmitBtn.addEventListener('click', async () => {
      const link = elements.linkInput.value.trim();
      if (!link) {
        showToast('Please enter a valid link');
        return;
      }
      if (!currentUser || !currentUser.premium) {
        showToast('Premium required for link deobfuscation');
        return;
      }
      
      // Show processing
      elements.uploadBox.style.display = 'none';
      elements.modeSwitchContainer.style.display = 'none';
      elements.settingsBtnHome.style.display = 'none';
      elements.processingContainer.classList.add('active');
      
      try {
        // Try to fetch the content from the URL
        const response = await fetch(link);
        if (!response.ok) {
          throw new Error('Failed to fetch URL');
        }
        const content = await response.text();
        
        // Reset UI first
        elements.processingContainer.classList.remove('active');
        elements.uploadBox.style.display = 'block';
        elements.modeSwitchContainer.style.display = 'flex';
        elements.settingsBtnHome.style.display = 'flex';
        
        // Process the content
        processFile(content);
      } catch (error) {
        // If fetch fails, just use the URL as content placeholder
        showToast('Could not fetch URL, processing as text...');
        processFile(`-- Content from URL: ${link}\n-- Direct fetch failed, please paste the code directly`);
      }
    });

    elements.linkInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        elements.linkSubmitBtn.click();
      }
    });

    // Mode toggle
    elements.modeToggle.addEventListener('change', toggleMode);

    // Settings
    elements.settingsOpenBtn.addEventListener('click', () => {
      elements.settingsModal.classList.add('visible');
    });

    elements.closeSettingsBtn.addEventListener('click', () => {
      elements.settingsModal.classList.remove('visible');
      showToast('Settings saved!');
    });

    elements.settingsModal.addEventListener('click', (e) => {
      if (e.target === elements.settingsModal) {
        elements.settingsModal.classList.remove('visible');
      }
    });

    // ==================== INITIALIZATION ====================
    setTimeout(() => {
      elements.loadingScreen.classList.add('hidden');

      if (loadData()) {
        elements.mainApp.classList.add('visible');
        if (currentUser.premium) {
          elements.modeSwitchContainer.classList.add('visible');
        }
        
        // Check if we should show profile after reload
        const showProfile = localStorage.getItem('illusionShowProfile');
        if (showProfile === 'true') {
          localStorage.removeItem('illusionShowProfile');
          elements.switchOpt2.checked = true;
          elements.homeSection.classList.remove('active');
          elements.profileSection.classList.add('active');
          showToast('Deobfuscation complete!');
        }
        
        renderFiles();
      } else {
        elements.loginContainer.classList.add('visible');
      }
    }, 2500);
  </script>
</body>
</html>
